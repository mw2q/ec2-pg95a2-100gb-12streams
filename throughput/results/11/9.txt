BEGIN;
BEGIN
select
	nation,
	o_year,
	sum(amount) as sum_profit
from
	(
		select
			n_name as nation,
			extract(year from o_orderdate) as o_year,
			l_extendedprice * (1 - l_discount) - ps_supplycost * l_quantity as amount
		from
			part,
			supplier,
			lineitem,
			partsupp,
			orders,
			nation
		where
			s_suppkey = l_suppkey
			and ps_suppkey = l_suppkey
			and ps_partkey = l_partkey
			and p_partkey = l_partkey
			and o_orderkey = l_orderkey
			and s_nationkey = n_nationkey
			and p_name like '%blanched%'
	) as profit
group by
	nation,
	o_year
order by
	nation,
	o_year desc;
          nation           | o_year |    sum_profit    
---------------------------+--------+------------------
 ALGERIA                   |   1998 | 2739414162.75741
 ALGERIA                   |   1997 | 4676954538.61475
 ALGERIA                   |   1996 | 4689697896.65821
 ALGERIA                   |   1995 | 4659469356.39638
 ALGERIA                   |   1994 | 4634868120.15454
 ALGERIA                   |   1993 | 4636727897.75439
 ALGERIA                   |   1992 |  4673539078.5251
 ARGENTINA                 |   1998 | 2721076998.41882
 ARGENTINA                 |   1997 | 4661905310.83197
 ARGENTINA                 |   1996 | 4637834528.85987
 ARGENTINA                 |   1995 | 4641210802.25974
 ARGENTINA                 |   1994 | 4650954046.53888
 ARGENTINA                 |   1993 | 4633422756.35226
 ARGENTINA                 |   1992 |  4668746619.3375
 BRAZIL                    |   1998 | 2735931520.31922
 BRAZIL                    |   1997 | 4684569526.16261
 BRAZIL                    |   1996 | 4681740496.75475
 BRAZIL                    |   1995 | 4679612401.82383
 BRAZIL                    |   1994 | 4676455241.58365
 BRAZIL                    |   1993 | 4690442120.35477
 BRAZIL                    |   1992 | 4671330838.51614
 CANADA                    |   1998 | 2734219509.62242
 CANADA                    |   1997 | 4687265794.61709
 CANADA                    |   1996 | 4698741738.15128
 CANADA                    |   1995 | 4684920829.52895
 CANADA                    |   1994 | 4703215133.88985
 CANADA                    |   1993 | 4672120958.76596
 CANADA                    |   1992 |  4713639403.7926
 CHINA                     |   1998 | 2730545318.56004
 CHINA                     |   1997 | 4648692985.33639
 CHINA                     |   1996 | 4699900310.85743
 CHINA                     |   1995 | 4671527339.28636
 CHINA                     |   1994 | 4686619210.59672
 CHINA                     |   1993 | 4660533934.67373
 CHINA                     |   1992 |  4689030878.7183
 EGYPT                     |   1998 | 2727741083.45286
 EGYPT                     |   1997 | 4639352260.34654
 EGYPT                     |   1996 | 4667349878.27677
 EGYPT                     |   1995 | 4662718786.78985
 EGYPT                     |   1994 | 4643982139.91378
 EGYPT                     |   1993 | 4658213663.03477
 EGYPT                     |   1992 | 4676103869.20685
 ETHIOPIA                  |   1998 | 2747124136.43583
 ETHIOPIA                  |   1997 | 4699497881.92084
 ETHIOPIA                  |   1996 | 4712677117.62634
 ETHIOPIA                  |   1995 |  4699426940.9769
 ETHIOPIA                  |   1994 | 4704076540.99358
 ETHIOPIA                  |   1993 | 4699747032.38773
 ETHIOPIA                  |   1992 | 4710253355.31168
 FRANCE                    |   1998 | 2740218005.64137
 FRANCE                    |   1997 | 4702644351.82829
 FRANCE                    |   1996 | 4698056389.69822
 FRANCE                    |   1995 | 4699733482.16124
 FRANCE                    |   1994 | 4702782113.91877
 FRANCE                    |   1993 | 4687033763.26666
 FRANCE                    |   1992 | 4684625278.69966
 GERMANY                   |   1998 | 2753535840.27923
 GERMANY                   |   1997 |  4693948429.8185
 GERMANY                   |   1996 | 4711867656.71915
 GERMANY                   |   1995 | 4695189335.92228
 GERMANY                   |   1994 | 4689311406.06938
 GERMANY                   |   1993 | 4679957341.84739
 GERMANY                   |   1992 | 4707885878.55197
 INDIA                     |   1998 | 2770194830.74314
 INDIA                     |   1997 | 4687718132.18243
 INDIA                     |   1996 | 4715525313.70037
 INDIA                     |   1995 | 4690081999.32981
 INDIA                     |   1994 | 4684762812.51412
 INDIA                     |   1993 | 4690367458.33516
 INDIA                     |   1992 | 4702208161.51995
 INDONESIA                 |   1998 |  2726682829.0962
 INDONESIA                 |   1997 |  4674364249.8753
 INDONESIA                 |   1996 |  4666783022.0764
 INDONESIA                 |   1995 | 4632098134.09938
 INDONESIA                 |   1994 | 4669269886.35828
 INDONESIA                 |   1993 | 4650283471.54158
 INDONESIA                 |   1992 |   4694549506.458
 IRAN                      |   1998 | 2721833397.70564
 IRAN                      |   1997 |  4619287807.1001
 IRAN                      |   1996 | 4623324732.58014
 IRAN                      |   1995 | 4635917827.50728
 IRAN                      |   1994 | 4615832628.09395
 IRAN                      |   1993 | 4647863901.99323
 IRAN                      |   1992 | 4641039148.11055
 IRAQ                      |   1998 | 2720348271.33193
 IRAQ                      |   1997 |  4664110205.7132
 IRAQ                      |   1996 | 4678208057.33853
 IRAQ                      |   1995 | 4656946994.66891
 IRAQ                      |   1994 | 4642944346.29597
 IRAQ                      |   1993 | 4669770025.80554
 IRAQ                      |   1992 | 4690091197.99566
 JAPAN                     |   1998 | 2712506098.30945
 JAPAN                     |   1997 | 4650997323.66093
 JAPAN                     |   1996 | 4686602486.81865
 JAPAN                     |   1995 | 4647997375.11777
 JAPAN                     |   1994 | 4673077098.07551
 JAPAN                     |   1993 | 4676136277.46268
 JAPAN                     |   1992 | 4661895639.23705
 JORDAN                    |   1998 | 2738498575.56423
 JORDAN                    |   1997 | 4662509814.89181
 JORDAN                    |   1996 | 4664920830.82824
 JORDAN                    |   1995 | 4654555038.65995
 JORDAN                    |   1994 | 4647260620.70448
 JORDAN                    |   1993 | 4636265175.69079
 JORDAN                    |   1992 | 4685563946.32765
 KENYA                     |   1998 | 2721391699.87551
 KENYA                     |   1997 | 4604178650.38279
 KENYA                     |   1996 | 4636959398.07874
 KENYA                     |   1995 | 4624737850.91897
 KENYA                     |   1994 | 4601969241.03226
 KENYA                     |   1993 | 4642796443.75718
 KENYA                     |   1992 | 4621056756.82841
 MOROCCO                   |   1998 | 2744698799.27639
 MOROCCO                   |   1997 | 4673966661.97331
 MOROCCO                   |   1996 | 4668159962.92662
 MOROCCO                   |   1995 | 4670488409.21391
 MOROCCO                   |   1994 | 4660724465.77819
 MOROCCO                   |   1993 | 4689151579.82545
 MOROCCO                   |   1992 | 4716527949.90018
 MOZAMBIQUE                |   1998 | 2742727716.73172
 MOZAMBIQUE                |   1997 | 4640336422.22598
 MOZAMBIQUE                |   1996 | 4686559594.47527
 MOZAMBIQUE                |   1995 | 4664610957.16354
 MOZAMBIQUE                |   1994 | 4640743362.17233
 MOZAMBIQUE                |   1993 | 4653544269.38779
 MOZAMBIQUE                |   1992 | 4660252188.56722
 PERU                      |   1998 | 2723599054.18043
 PERU                      |   1997 |  4623095735.9689
 PERU                      |   1996 | 4662058075.57255
 PERU                      |   1995 | 4659249393.73873
 PERU                      |   1994 | 4661467523.08037
 PERU                      |   1993 |  4620024316.9843
 PERU                      |   1992 | 4641625596.31348
 ROMANIA                   |   1998 | 2735710193.75996
 ROMANIA                   |   1997 | 4664048796.63197
 ROMANIA                   |   1996 | 4708942118.56233
 ROMANIA                   |   1995 | 4656501459.95591
 ROMANIA                   |   1994 | 4691354629.24401
 ROMANIA                   |   1993 | 4693471151.47362
 ROMANIA                   |   1992 | 4698831249.80847
 RUSSIA                    |   1998 |  2741648703.9952
 RUSSIA                    |   1997 | 4686725051.73561
 RUSSIA                    |   1996 | 4684772374.23166
 RUSSIA                    |   1995 | 4687078267.11176
 RUSSIA                    |   1994 | 4677804815.40055
 RUSSIA                    |   1993 | 4686896038.13728
 RUSSIA                    |   1992 | 4706839859.06471
 SAUDI ARABIA              |   1998 | 2721676717.55552
 SAUDI ARABIA              |   1997 | 4652873967.83033
 SAUDI ARABIA              |   1996 | 4666306317.57244
 SAUDI ARABIA              |   1995 | 4639566073.26941
 SAUDI ARABIA              |   1994 | 4677106567.08989
 SAUDI ARABIA              |   1993 | 4637078723.58093
 SAUDI ARABIA              |   1992 | 4677679808.12468
 UNITED KINGDOM            |   1998 | 2767992369.11993
 UNITED KINGDOM            |   1997 | 4697248739.27555
 UNITED KINGDOM            |   1996 | 4713483709.73648
 UNITED KINGDOM            |   1995 | 4710721554.18265
 UNITED KINGDOM            |   1994 | 4687625911.67495
 UNITED KINGDOM            |   1993 | 4672233278.11324
 UNITED KINGDOM            |   1992 | 4711057437.69653
 UNITED STATES             |   1998 | 2731505051.51108
 UNITED STATES             |   1997 | 4691048292.14479
 UNITED STATES             |   1996 | 4711875670.86044
 UNITED STATES             |   1995 | 4675889498.98795
 UNITED STATES             |   1994 | 4679516903.20358
 UNITED STATES             |   1993 | 4687113588.67134
 UNITED STATES             |   1992 | 4686130664.27635
 VIETNAM                   |   1998 | 2735089667.60841
 VIETNAM                   |   1997 | 4660916519.18467
 VIETNAM                   |   1996 | 4671008677.53857
 VIETNAM                   |   1995 | 4677330853.03652
 VIETNAM                   |   1994 | 4675660439.24372
 VIETNAM                   |   1993 | 4671435176.21192
 VIETNAM                   |   1992 | 4690717749.21917
(175 rows)

COMMIT;
COMMIT
