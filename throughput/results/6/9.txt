BEGIN;
BEGIN
select
	nation,
	o_year,
	sum(amount) as sum_profit
from
	(
		select
			n_name as nation,
			extract(year from o_orderdate) as o_year,
			l_extendedprice * (1 - l_discount) - ps_supplycost * l_quantity as amount
		from
			part,
			supplier,
			lineitem,
			partsupp,
			orders,
			nation
		where
			s_suppkey = l_suppkey
			and ps_suppkey = l_suppkey
			and ps_partkey = l_partkey
			and p_partkey = l_partkey
			and o_orderkey = l_orderkey
			and s_nationkey = n_nationkey
			and p_name like '%ivory%'
	) as profit
group by
	nation,
	o_year
order by
	nation,
	o_year desc;
          nation           | o_year |    sum_profit    
---------------------------+--------+------------------
 ALGERIA                   |   1998 | 2742169359.39091
 ALGERIA                   |   1997 | 4669422617.77154
 ALGERIA                   |   1996 | 4683028418.74262
 ALGERIA                   |   1995 | 4672853964.87683
 ALGERIA                   |   1994 | 4661254989.58398
 ALGERIA                   |   1993 | 4682639296.33948
 ALGERIA                   |   1992 | 4675393616.41091
 ARGENTINA                 |   1998 | 2709900467.07013
 ARGENTINA                 |   1997 | 4625772663.34879
 ARGENTINA                 |   1996 | 4648015408.14878
 ARGENTINA                 |   1995 | 4619158701.22995
 ARGENTINA                 |   1994 | 4627014379.33083
 ARGENTINA                 |   1993 | 4644935797.93745
 ARGENTINA                 |   1992 | 4628641643.55911
 BRAZIL                    |   1998 | 2737411188.17682
 BRAZIL                    |   1997 |  4679908555.3891
 BRAZIL                    |   1996 | 4688268803.73656
 BRAZIL                    |   1995 | 4679769389.08822
 BRAZIL                    |   1994 | 4691420220.87105
 BRAZIL                    |   1993 | 4690345259.73297
 BRAZIL                    |   1992 |  4699887911.1428
 CANADA                    |   1998 | 2734855508.77319
 CANADA                    |   1997 | 4693258948.77378
 CANADA                    |   1996 | 4713272731.57535
 CANADA                    |   1995 | 4706766700.48943
 CANADA                    |   1994 | 4690424191.03475
 CANADA                    |   1993 |  4668743367.4686
 CANADA                    |   1992 | 4700048975.27103
 CHINA                     |   1998 | 2749724006.71933
 CHINA                     |   1997 | 4650805690.69232
 CHINA                     |   1996 | 4666479537.27949
 CHINA                     |   1995 | 4671499190.00652
 CHINA                     |   1994 | 4649051356.18083
 CHINA                     |   1993 | 4667676870.88668
 CHINA                     |   1992 | 4672697665.72041
 EGYPT                     |   1998 | 2717032278.41766
 EGYPT                     |   1997 | 4660242055.52872
 EGYPT                     |   1996 | 4656625202.71533
 EGYPT                     |   1995 | 4651975624.40093
 EGYPT                     |   1994 | 4654518604.04781
 EGYPT                     |   1993 | 4659766948.53483
 EGYPT                     |   1992 | 4667578182.18987
 ETHIOPIA                  |   1998 | 2767867892.89843
 ETHIOPIA                  |   1997 | 4722480972.72416
 ETHIOPIA                  |   1996 | 4709387696.18527
 ETHIOPIA                  |   1995 | 4702354496.23544
 ETHIOPIA                  |   1994 | 4748426703.02847
 ETHIOPIA                  |   1993 | 4732455492.38834
 ETHIOPIA                  |   1992 | 4693215593.76454
 FRANCE                    |   1998 | 2725295004.02778
 FRANCE                    |   1997 | 4666461637.16376
 FRANCE                    |   1996 | 4679190351.87518
 FRANCE                    |   1995 | 4702294598.85302
 FRANCE                    |   1994 | 4701895815.94273
 FRANCE                    |   1993 |  4677694050.3744
 FRANCE                    |   1992 | 4691575765.54365
 GERMANY                   |   1998 | 2723476883.39321
 GERMANY                   |   1997 | 4683502483.88366
 GERMANY                   |   1996 | 4693103970.84306
 GERMANY                   |   1995 | 4668532109.09267
 GERMANY                   |   1994 | 4698252195.73733
 GERMANY                   |   1993 | 4669090921.77255
 GERMANY                   |   1992 | 4692335648.14898
 INDIA                     |   1998 |  2733693480.2856
 INDIA                     |   1997 | 4661400949.83232
 INDIA                     |   1996 |  4673098386.5633
 INDIA                     |   1995 | 4659525536.27906
 INDIA                     |   1994 | 4662580010.73312
 INDIA                     |   1993 | 4642106060.98076
 INDIA                     |   1992 | 4671467177.89341
 INDONESIA                 |   1998 | 2735422489.04919
 INDONESIA                 |   1997 | 4641699307.74847
 INDONESIA                 |   1996 | 4655249365.22872
 INDONESIA                 |   1995 | 4654714224.13083
 INDONESIA                 |   1994 | 4630719451.42019
 INDONESIA                 |   1993 | 4651200692.38616
 INDONESIA                 |   1992 | 4655967608.43247
 IRAN                      |   1998 | 2724333336.47285
 IRAN                      |   1997 | 4629983133.41915
 IRAN                      |   1996 | 4648109683.39778
 IRAN                      |   1995 | 4634971611.84057
 IRAN                      |   1994 | 4656354210.49728
 IRAN                      |   1993 | 4641792041.85354
 IRAN                      |   1992 | 4661742591.35044
 IRAQ                      |   1998 | 2712008104.80519
 IRAQ                      |   1997 | 4626770164.23633
 IRAQ                      |   1996 | 4657913502.63505
 IRAQ                      |   1995 | 4653003597.40439
 IRAQ                      |   1994 |  4623692259.7963
 IRAQ                      |   1993 | 4651213741.33814
 IRAQ                      |   1992 | 4653169662.78409
 JAPAN                     |   1998 | 2712271055.45785
 JAPAN                     |   1997 |  4619717131.3733
 JAPAN                     |   1996 | 4666689363.17058
 JAPAN                     |   1995 | 4646083526.20823
 JAPAN                     |   1994 |  4632399129.9843
 JAPAN                     |   1993 | 4617575034.37152
 JAPAN                     |   1992 | 4622881884.44988
 JORDAN                    |   1998 | 2751540093.92468
 JORDAN                    |   1997 | 4677255534.21038
 JORDAN                    |   1996 | 4681714686.62927
 JORDAN                    |   1995 | 4676124287.40536
 JORDAN                    |   1994 | 4688601015.55081
 JORDAN                    |   1993 | 4680647392.90616
 JORDAN                    |   1992 |   4688663407.989
 KENYA                     |   1998 | 2722244800.64379
 KENYA                     |   1997 | 4634395558.43489
 KENYA                     |   1996 |  4643389626.5319
 KENYA                     |   1995 | 4641125517.92733
 KENYA                     |   1994 | 4667863641.03073
 KENYA                     |   1993 | 4625849676.50052
 KENYA                     |   1992 | 4637033536.19228
 MOROCCO                   |   1998 | 2735636969.65605
 MOROCCO                   |   1997 | 4676988403.51103
 MOROCCO                   |   1996 | 4673765121.47462
 MOROCCO                   |   1995 | 4662120558.54117
 MOROCCO                   |   1994 | 4668974126.46145
 MOROCCO                   |   1993 | 4664274351.18961
 MOROCCO                   |   1992 | 4674907059.10587
 MOZAMBIQUE                |   1998 | 2740984411.88602
 MOZAMBIQUE                |   1997 |   4690491731.867
 MOZAMBIQUE                |   1996 | 4685188973.78442
 MOZAMBIQUE                |   1995 | 4679088854.30057
 MOZAMBIQUE                |   1994 | 4668431841.08759
 MOZAMBIQUE                |   1993 | 4701327306.01632
 MOZAMBIQUE                |   1992 | 4656907426.38953
 PERU                      |   1998 | 2715749847.59642
 PERU                      |   1997 |  4647349700.5478
 PERU                      |   1996 | 4643493754.21263
 PERU                      |   1995 | 4650055392.88524
 PERU                      |   1994 | 4644500913.31956
 PERU                      |   1993 | 4621286048.39894
 PERU                      |   1992 | 4665633823.57047
 ROMANIA                   |   1998 | 2736928842.98215
 ROMANIA                   |   1997 | 4669161582.79185
 ROMANIA                   |   1996 | 4673505983.77555
 ROMANIA                   |   1995 | 4663176994.47899
 ROMANIA                   |   1994 |  4666717393.8655
 ROMANIA                   |   1993 | 4701895485.82495
 ROMANIA                   |   1992 | 4701572752.39849
 RUSSIA                    |   1998 | 2725166340.81057
 RUSSIA                    |   1997 | 4666955935.53064
 RUSSIA                    |   1996 | 4690336405.13378
 RUSSIA                    |   1995 | 4677416037.62494
 RUSSIA                    |   1994 | 4652602490.72882
 RUSSIA                    |   1993 | 4654110748.42231
 RUSSIA                    |   1992 | 4659101910.95825
 SAUDI ARABIA              |   1998 | 2728448999.29393
 SAUDI ARABIA              |   1997 | 4655547740.89443
 SAUDI ARABIA              |   1996 | 4687004274.27499
 SAUDI ARABIA              |   1995 | 4673783728.01257
 SAUDI ARABIA              |   1994 | 4673815041.08641
 SAUDI ARABIA              |   1993 | 4686014904.77437
 SAUDI ARABIA              |   1992 | 4658841027.32018
 UNITED KINGDOM            |   1998 | 2754835966.91874
 UNITED KINGDOM            |   1997 | 4700524716.23782
 UNITED KINGDOM            |   1996 | 4716464584.02781
 UNITED KINGDOM            |   1995 | 4704886295.08239
 UNITED KINGDOM            |   1994 | 4702749615.49282
 UNITED KINGDOM            |   1993 | 4672881891.69658
 UNITED KINGDOM            |   1992 | 4695932821.80035
 UNITED STATES             |   1998 | 2717624495.30285
 UNITED STATES             |   1997 |  4663658543.5015
 UNITED STATES             |   1996 | 4660753483.11902
 UNITED STATES             |   1995 | 4651589907.13503
 UNITED STATES             |   1994 | 4689207093.87256
 UNITED STATES             |   1993 | 4663334617.17052
 UNITED STATES             |   1992 | 4665699285.00489
 VIETNAM                   |   1998 | 2743998795.80854
 VIETNAM                   |   1997 | 4674734804.77734
 VIETNAM                   |   1996 | 4684347948.12013
 VIETNAM                   |   1995 | 4686029148.14371
 VIETNAM                   |   1994 |  4669847960.3348
 VIETNAM                   |   1993 | 4664885760.02617
 VIETNAM                   |   1992 | 4680573771.60172
(175 rows)

COMMIT;
COMMIT
