BEGIN;
BEGIN
select
	nation,
	o_year,
	sum(amount) as sum_profit
from
	(
		select
			n_name as nation,
			extract(year from o_orderdate) as o_year,
			l_extendedprice * (1 - l_discount) - ps_supplycost * l_quantity as amount
		from
			part,
			supplier,
			lineitem,
			partsupp,
			orders,
			nation
		where
			s_suppkey = l_suppkey
			and ps_suppkey = l_suppkey
			and ps_partkey = l_partkey
			and p_partkey = l_partkey
			and o_orderkey = l_orderkey
			and s_nationkey = n_nationkey
			and p_name like '%light%'
	) as profit
group by
	nation,
	o_year
order by
	nation,
	o_year desc;
          nation           | o_year |    sum_profit    
---------------------------+--------+------------------
 ALGERIA                   |   1998 | 2736586516.88277
 ALGERIA                   |   1997 | 4669297806.81616
 ALGERIA                   |   1996 |  4714992106.0897
 ALGERIA                   |   1995 | 4707015026.70731
 ALGERIA                   |   1994 | 4665056769.38248
 ALGERIA                   |   1993 | 4684172333.07911
 ALGERIA                   |   1992 | 4695031737.49539
 ARGENTINA                 |   1998 | 2713826018.20715
 ARGENTINA                 |   1997 | 4605978000.81054
 ARGENTINA                 |   1996 | 4662581653.11134
 ARGENTINA                 |   1995 | 4640401183.93256
 ARGENTINA                 |   1994 | 4660799495.70292
 ARGENTINA                 |   1993 | 4652554431.40338
 ARGENTINA                 |   1992 | 4644365986.20485
 BRAZIL                    |   1998 | 2724413811.81296
 BRAZIL                    |   1997 | 4690669585.32508
 BRAZIL                    |   1996 | 4666067820.57131
 BRAZIL                    |   1995 |  4651644404.7071
 BRAZIL                    |   1994 | 4653023846.28778
 BRAZIL                    |   1993 | 4642783390.12781
 BRAZIL                    |   1992 | 4663082402.75391
 CANADA                    |   1998 | 2755941297.15405
 CANADA                    |   1997 |  4671898866.2977
 CANADA                    |   1996 | 4697833014.96266
 CANADA                    |   1995 | 4698506512.84211
 CANADA                    |   1994 | 4681393061.93992
 CANADA                    |   1993 |  4683717407.2815
 CANADA                    |   1992 | 4713879243.55568
 CHINA                     |   1998 |  2747881310.3983
 CHINA                     |   1997 |  4663400336.0116
 CHINA                     |   1996 | 4683684989.79022
 CHINA                     |   1995 | 4671256678.27683
 CHINA                     |   1994 | 4672989522.56553
 CHINA                     |   1993 | 4657352416.79996
 CHINA                     |   1992 | 4656430402.29866
 EGYPT                     |   1998 | 2724289755.86385
 EGYPT                     |   1997 | 4669504538.61284
 EGYPT                     |   1996 | 4687347300.73084
 EGYPT                     |   1995 | 4656068461.30372
 EGYPT                     |   1994 | 4650827423.01368
 EGYPT                     |   1993 | 4650999523.88903
 EGYPT                     |   1992 |   4658197609.549
 ETHIOPIA                  |   1998 | 2733714023.56107
 ETHIOPIA                  |   1997 | 4680344175.22461
 ETHIOPIA                  |   1996 | 4704815448.52363
 ETHIOPIA                  |   1995 | 4683142142.29939
 ETHIOPIA                  |   1994 | 4678321204.68524
 ETHIOPIA                  |   1993 | 4678679798.71982
 ETHIOPIA                  |   1992 | 4686469780.90823
 FRANCE                    |   1998 | 2747043229.52011
 FRANCE                    |   1997 | 4692344767.71713
 FRANCE                    |   1996 | 4704999550.45592
 FRANCE                    |   1995 | 4689950716.10568
 FRANCE                    |   1994 | 4699357602.41927
 FRANCE                    |   1993 | 4694426152.31097
 FRANCE                    |   1992 | 4696100808.03965
 GERMANY                   |   1998 | 2749891229.78019
 GERMANY                   |   1997 | 4699123658.32157
 GERMANY                   |   1996 | 4711357620.59556
 GERMANY                   |   1995 | 4681605310.23202
 GERMANY                   |   1994 | 4685661624.82562
 GERMANY                   |   1993 | 4671122929.72656
 GERMANY                   |   1992 | 4671544365.19151
 INDIA                     |   1998 | 2752863177.07102
 INDIA                     |   1997 | 4701258731.27844
 INDIA                     |   1996 | 4698677117.80381
 INDIA                     |   1995 | 4684354469.89626
 INDIA                     |   1994 | 4682137102.24716
 INDIA                     |   1993 | 4712052789.51878
 INDIA                     |   1992 | 4725217436.22403
 INDONESIA                 |   1998 | 2738402506.89862
 INDONESIA                 |   1997 |  4645884174.1165
 INDONESIA                 |   1996 | 4655649989.67416
 INDONESIA                 |   1995 | 4635734305.35216
 INDONESIA                 |   1994 | 4650605789.34301
 INDONESIA                 |   1993 | 4661220928.47705
 INDONESIA                 |   1992 |  4608417085.4723
 IRAN                      |   1998 | 2732588322.96039
 IRAN                      |   1997 | 4659745861.43159
 IRAN                      |   1996 | 4680102883.98705
 IRAN                      |   1995 | 4660612907.56246
 IRAN                      |   1994 |  4651970774.6931
 IRAN                      |   1993 | 4630738252.27692
 IRAN                      |   1992 | 4627645546.66611
 IRAQ                      |   1998 |  2726269703.2452
 IRAQ                      |   1997 | 4652848290.56509
 IRAQ                      |   1996 | 4683897142.40708
 IRAQ                      |   1995 | 4631678562.26116
 IRAQ                      |   1994 | 4652566963.74178
 IRAQ                      |   1993 | 4666762190.61748
 IRAQ                      |   1992 | 4675167383.76683
 JAPAN                     |   1998 | 2708787253.76361
 JAPAN                     |   1997 | 4615722797.41434
 JAPAN                     |   1996 | 4609500156.57721
 JAPAN                     |   1995 | 4634904447.21528
 JAPAN                     |   1994 | 4632707751.56749
 JAPAN                     |   1993 | 4631440980.62366
 JAPAN                     |   1992 | 4629428902.41324
 JORDAN                    |   1998 |  2727910138.3383
 JORDAN                    |   1997 | 4649697468.93008
 JORDAN                    |   1996 | 4693107394.46151
 JORDAN                    |   1995 | 4652233985.50459
 JORDAN                    |   1994 | 4665893904.93153
 JORDAN                    |   1993 | 4669423588.92015
 JORDAN                    |   1992 | 4672027442.29906
 KENYA                     |   1998 | 2719982039.23329
 KENYA                     |   1997 |  4660508386.9745
 KENYA                     |   1996 | 4676142622.00803
 KENYA                     |   1995 | 4649723066.15648
 KENYA                     |   1994 | 4642305692.29383
 KENYA                     |   1993 | 4641157046.68355
 KENYA                     |   1992 | 4647701478.37445
 MOROCCO                   |   1998 |  2736423495.2105
 MOROCCO                   |   1997 | 4660322994.85879
 MOROCCO                   |   1996 | 4671827100.61204
 MOROCCO                   |   1995 | 4685737161.38513
 MOROCCO                   |   1994 | 4666252402.22497
 MOROCCO                   |   1993 | 4677084377.10779
 MOROCCO                   |   1992 | 4674462438.12942
 MOZAMBIQUE                |   1998 | 2739171456.31376
 MOZAMBIQUE                |   1997 | 4670916621.55748
 MOZAMBIQUE                |   1996 |  4654915815.5521
 MOZAMBIQUE                |   1995 | 4669115390.98094
 MOZAMBIQUE                |   1994 | 4651430299.59774
 MOZAMBIQUE                |   1993 | 4640186449.08988
 MOZAMBIQUE                |   1992 | 4658269151.06446
 PERU                      |   1998 | 2720215488.00738
 PERU                      |   1997 | 4639428280.15786
 PERU                      |   1996 | 4624363693.71513
 PERU                      |   1995 | 4641052406.33367
 PERU                      |   1994 | 4642064570.45073
 PERU                      |   1993 | 4622021641.82535
 PERU                      |   1992 | 4636077606.36654
 ROMANIA                   |   1998 | 2742307021.72076
 ROMANIA                   |   1997 | 4661400010.25287
 ROMANIA                   |   1996 | 4674022734.78419
 ROMANIA                   |   1995 | 4656143666.97304
 ROMANIA                   |   1994 | 4658279391.47222
 ROMANIA                   |   1993 | 4665197946.42248
 ROMANIA                   |   1992 |    4675037253.37
 RUSSIA                    |   1998 | 2730359215.73372
 RUSSIA                    |   1997 | 4682154706.59403
 RUSSIA                    |   1996 | 4678005610.39971
 RUSSIA                    |   1995 | 4656696131.54844
 RUSSIA                    |   1994 | 4672131645.42318
 RUSSIA                    |   1993 | 4662115384.55051
 RUSSIA                    |   1992 | 4718953942.22276
 SAUDI ARABIA              |   1998 | 2708166307.23004
 SAUDI ARABIA              |   1997 | 4638208484.23945
 SAUDI ARABIA              |   1996 | 4670304138.55931
 SAUDI ARABIA              |   1995 | 4635381911.70732
 SAUDI ARABIA              |   1994 | 4639443603.69706
 SAUDI ARABIA              |   1993 |  4652292135.6896
 SAUDI ARABIA              |   1992 | 4661853991.42457
 UNITED KINGDOM            |   1998 | 2748725531.13922
 UNITED KINGDOM            |   1997 | 4671919280.07122
 UNITED KINGDOM            |   1996 | 4692766770.43027
 UNITED KINGDOM            |   1995 | 4691974384.34288
 UNITED KINGDOM            |   1994 | 4674524190.65292
 UNITED KINGDOM            |   1993 | 4668589329.08837
 UNITED KINGDOM            |   1992 |  4689734087.7331
 UNITED STATES             |   1998 | 2716582870.27444
 UNITED STATES             |   1997 | 4672255614.34967
 UNITED STATES             |   1996 | 4692341256.41949
 UNITED STATES             |   1995 | 4652484745.06474
 UNITED STATES             |   1994 | 4689416483.33941
 UNITED STATES             |   1993 | 4680696745.73058
 UNITED STATES             |   1992 |  4690915780.4545
 VIETNAM                   |   1998 | 2758920669.84236
 VIETNAM                   |   1997 | 4648317139.25696
 VIETNAM                   |   1996 | 4673035228.30917
 VIETNAM                   |   1995 | 4684487184.66433
 VIETNAM                   |   1994 | 4676644891.97091
 VIETNAM                   |   1993 | 4683697224.60408
 VIETNAM                   |   1992 | 4653426887.07279
(175 rows)

COMMIT;
COMMIT
