BEGIN;
BEGIN
select
	nation,
	o_year,
	sum(amount) as sum_profit
from
	(
		select
			n_name as nation,
			extract(year from o_orderdate) as o_year,
			l_extendedprice * (1 - l_discount) - ps_supplycost * l_quantity as amount
		from
			part,
			supplier,
			lineitem,
			partsupp,
			orders,
			nation
		where
			s_suppkey = l_suppkey
			and ps_suppkey = l_suppkey
			and ps_partkey = l_partkey
			and p_partkey = l_partkey
			and o_orderkey = l_orderkey
			and s_nationkey = n_nationkey
			and p_name like '%purple%'
	) as profit
group by
	nation,
	o_year
order by
	nation,
	o_year desc;
          nation           | o_year |    sum_profit    
---------------------------+--------+------------------
 ALGERIA                   |   1998 | 2734935418.11853
 ALGERIA                   |   1997 | 4679060643.22163
 ALGERIA                   |   1996 | 4662131915.08309
 ALGERIA                   |   1995 |  4663425050.1886
 ALGERIA                   |   1994 | 4675019293.76276
 ALGERIA                   |   1993 | 4672681782.77707
 ALGERIA                   |   1992 | 4657190811.67607
 ARGENTINA                 |   1998 | 2732567452.72086
 ARGENTINA                 |   1997 | 4650979700.14868
 ARGENTINA                 |   1996 | 4691021024.16666
 ARGENTINA                 |   1995 | 4662648384.02497
 ARGENTINA                 |   1994 | 4648684680.18748
 ARGENTINA                 |   1993 | 4667856601.21973
 ARGENTINA                 |   1992 | 4671107201.88018
 BRAZIL                    |   1998 |  2715154519.8708
 BRAZIL                    |   1997 | 4671766822.05557
 BRAZIL                    |   1996 | 4664085018.33987
 BRAZIL                    |   1995 | 4657465520.90667
 BRAZIL                    |   1994 | 4663868258.08608
 BRAZIL                    |   1993 | 4665801408.84741
 BRAZIL                    |   1992 | 4688307341.56048
 CANADA                    |   1998 | 2746028573.25582
 CANADA                    |   1997 | 4695502980.31916
 CANADA                    |   1996 | 4669336716.94872
 CANADA                    |   1995 | 4701576341.93956
 CANADA                    |   1994 | 4707510445.97748
 CANADA                    |   1993 | 4689171263.20187
 CANADA                    |   1992 | 4681363918.63078
 CHINA                     |   1998 | 2714361551.71904
 CHINA                     |   1997 | 4657343666.73956
 CHINA                     |   1996 | 4638716784.47741
 CHINA                     |   1995 | 4641724648.63694
 CHINA                     |   1994 | 4634623882.61229
 CHINA                     |   1993 | 4625753220.79731
 CHINA                     |   1992 | 4679490397.46858
 EGYPT                     |   1998 | 2722991955.51627
 EGYPT                     |   1997 |  4665951722.2694
 EGYPT                     |   1996 | 4678851893.13576
 EGYPT                     |   1995 | 4663780572.14001
 EGYPT                     |   1994 | 4671020318.09112
 EGYPT                     |   1993 | 4665481993.92465
 EGYPT                     |   1992 | 4666893384.85478
 ETHIOPIA                  |   1998 | 2766428984.00576
 ETHIOPIA                  |   1997 | 4728778234.81093
 ETHIOPIA                  |   1996 | 4747322547.63459
 ETHIOPIA                  |   1995 | 4708929368.03186
 ETHIOPIA                  |   1994 |  4728968966.2016
 ETHIOPIA                  |   1993 | 4718107435.24774
 ETHIOPIA                  |   1992 | 4713789342.97961
 FRANCE                    |   1998 | 2732242683.27012
 FRANCE                    |   1997 | 4662956876.37164
 FRANCE                    |   1996 | 4668012890.39682
 FRANCE                    |   1995 | 4649860406.20301
 FRANCE                    |   1994 | 4635725588.67378
 FRANCE                    |   1993 | 4642133723.65059
 FRANCE                    |   1992 | 4674341049.55917
 GERMANY                   |   1998 | 2748431025.42908
 GERMANY                   |   1997 |  4697734352.5498
 GERMANY                   |   1996 | 4696646702.19673
 GERMANY                   |   1995 |  4659586441.2167
 GERMANY                   |   1994 | 4672870579.23121
 GERMANY                   |   1993 | 4673484545.04688
 GERMANY                   |   1992 | 4672294540.01692
 INDIA                     |   1998 | 2746364175.95159
 INDIA                     |   1997 | 4672450051.57927
 INDIA                     |   1996 | 4676074478.02672
 INDIA                     |   1995 | 4669088044.90039
 INDIA                     |   1994 | 4677632967.34991
 INDIA                     |   1993 | 4674857609.13964
 INDIA                     |   1992 | 4682095376.48229
 INDONESIA                 |   1998 | 2728389421.80399
 INDONESIA                 |   1997 | 4640252545.53225
 INDONESIA                 |   1996 | 4612827345.03979
 INDONESIA                 |   1995 |  4628412363.3955
 INDONESIA                 |   1994 | 4649538781.04829
 INDONESIA                 |   1993 |  4629563573.0603
 INDONESIA                 |   1992 | 4636199964.19296
 IRAN                      |   1998 | 2731983067.82037
 IRAN                      |   1997 | 4646640668.10114
 IRAN                      |   1996 |  4632983354.5451
 IRAN                      |   1995 |  4638708532.6431
 IRAN                      |   1994 | 4656394725.26384
 IRAN                      |   1993 | 4664226865.27896
 IRAN                      |   1992 | 4664923629.12743
 IRAQ                      |   1998 | 2711135568.03399
 IRAQ                      |   1997 | 4623724941.64091
 IRAQ                      |   1996 | 4668246507.27406
 IRAQ                      |   1995 | 4640942449.07338
 IRAQ                      |   1994 | 4654462342.54451
 IRAQ                      |   1993 | 4651205667.75576
 IRAQ                      |   1992 | 4669344673.68703
 JAPAN                     |   1998 |  2714567731.5539
 JAPAN                     |   1997 |  4611965377.0088
 JAPAN                     |   1996 | 4625756760.27202
 JAPAN                     |   1995 | 4650575310.90896
 JAPAN                     |   1994 | 4632225363.60277
 JAPAN                     |   1993 | 4622806592.15892
 JAPAN                     |   1992 | 4646480619.28794
 JORDAN                    |   1998 |  2749944742.1415
 JORDAN                    |   1997 | 4679736903.38008
 JORDAN                    |   1996 | 4695647216.23213
 JORDAN                    |   1995 | 4683365202.30273
 JORDAN                    |   1994 | 4673523740.58406
 JORDAN                    |   1993 | 4685456267.03945
 JORDAN                    |   1992 | 4688863096.19181
 KENYA                     |   1998 | 2722334061.39842
 KENYA                     |   1997 | 4620281273.09593
 KENYA                     |   1996 | 4642580631.28293
 KENYA                     |   1995 | 4631256676.84411
 KENYA                     |   1994 | 4639416373.57081
 KENYA                     |   1993 | 4645990606.24386
 KENYA                     |   1992 | 4663549859.15984
 MOROCCO                   |   1998 | 2760775006.86695
 MOROCCO                   |   1997 | 4681724096.17746
 MOROCCO                   |   1996 | 4699669489.06983
 MOROCCO                   |   1995 |  4672895511.9709
 MOROCCO                   |   1994 | 4686355937.34768
 MOROCCO                   |   1993 | 4693071497.79366
 MOROCCO                   |   1992 | 4705510866.73903
 MOZAMBIQUE                |   1998 | 2747662215.63134
 MOZAMBIQUE                |   1997 | 4675926645.74594
 MOZAMBIQUE                |   1996 | 4686583781.90608
 MOZAMBIQUE                |   1995 | 4652096332.34633
 MOZAMBIQUE                |   1994 | 4656770925.64768
 MOZAMBIQUE                |   1993 |  4658113448.7622
 MOZAMBIQUE                |   1992 | 4665651039.98615
 PERU                      |   1998 | 2721514434.10957
 PERU                      |   1997 | 4638854248.93572
 PERU                      |   1996 | 4645560883.92024
 PERU                      |   1995 | 4632361553.29785
 PERU                      |   1994 | 4635835221.11951
 PERU                      |   1993 | 4630141859.06408
 PERU                      |   1992 | 4645645725.26238
 ROMANIA                   |   1998 | 2751503902.84498
 ROMANIA                   |   1997 | 4685672582.36929
 ROMANIA                   |   1996 | 4709439935.72266
 ROMANIA                   |   1995 | 4677909296.43022
 ROMANIA                   |   1994 | 4718402564.56061
 ROMANIA                   |   1993 | 4664317002.59811
 ROMANIA                   |   1992 | 4700803770.49392
 RUSSIA                    |   1998 | 2731950813.26376
 RUSSIA                    |   1997 | 4676390238.48268
 RUSSIA                    |   1996 | 4701388066.52297
 RUSSIA                    |   1995 | 4651510406.06156
 RUSSIA                    |   1994 | 4687853694.08259
 RUSSIA                    |   1993 | 4677500038.40086
 RUSSIA                    |   1992 | 4671872489.52451
 SAUDI ARABIA              |   1998 | 2728001461.15374
 SAUDI ARABIA              |   1997 | 4654565250.13545
 SAUDI ARABIA              |   1996 | 4665018158.79714
 SAUDI ARABIA              |   1995 | 4640209943.97556
 SAUDI ARABIA              |   1994 | 4670692792.69973
 SAUDI ARABIA              |   1993 | 4669739505.84828
 SAUDI ARABIA              |   1992 | 4675814482.04338
 UNITED KINGDOM            |   1998 | 2772947803.16677
 UNITED KINGDOM            |   1997 | 4714401344.05797
 UNITED KINGDOM            |   1996 | 4708683320.40025
 UNITED KINGDOM            |   1995 | 4676958112.28205
 UNITED KINGDOM            |   1994 | 4710147797.84125
 UNITED KINGDOM            |   1993 | 4691469325.41835
 UNITED KINGDOM            |   1992 | 4717862043.34875
 UNITED STATES             |   1998 | 2729488075.06165
 UNITED STATES             |   1997 | 4664627495.60056
 UNITED STATES             |   1996 | 4684590746.97505
 UNITED STATES             |   1995 | 4655501093.36015
 UNITED STATES             |   1994 | 4670667227.98129
 UNITED STATES             |   1993 | 4673178969.33286
 UNITED STATES             |   1992 | 4682101082.95312
 VIETNAM                   |   1998 | 2734578038.44387
 VIETNAM                   |   1997 | 4701200875.06612
 VIETNAM                   |   1996 | 4727268946.33258
 VIETNAM                   |   1995 | 4714958907.09511
 VIETNAM                   |   1994 | 4691580199.83777
 VIETNAM                   |   1993 | 4693251105.98187
 VIETNAM                   |   1992 | 4720252712.47833
(175 rows)

COMMIT;
COMMIT
