BEGIN;
BEGIN
select
	nation,
	o_year,
	sum(amount) as sum_profit
from
	(
		select
			n_name as nation,
			extract(year from o_orderdate) as o_year,
			l_extendedprice * (1 - l_discount) - ps_supplycost * l_quantity as amount
		from
			part,
			supplier,
			lineitem,
			partsupp,
			orders,
			nation
		where
			s_suppkey = l_suppkey
			and ps_suppkey = l_suppkey
			and ps_partkey = l_partkey
			and p_partkey = l_partkey
			and o_orderkey = l_orderkey
			and s_nationkey = n_nationkey
			and p_name like '%metallic%'
	) as profit
group by
	nation,
	o_year
order by
	nation,
	o_year desc;
          nation           | o_year |    sum_profit    
---------------------------+--------+------------------
 ALGERIA                   |   1998 | 2734177868.96624
 ALGERIA                   |   1997 | 4668228936.81934
 ALGERIA                   |   1996 |  4679130903.7973
 ALGERIA                   |   1995 |  4662642349.5679
 ALGERIA                   |   1994 | 4689727181.46306
 ALGERIA                   |   1993 |  4661916970.5867
 ALGERIA                   |   1992 | 4679019259.23957
 ARGENTINA                 |   1998 | 2718240462.48719
 ARGENTINA                 |   1997 | 4649383315.08586
 ARGENTINA                 |   1996 | 4646997745.58744
 ARGENTINA                 |   1995 | 4598499627.67106
 ARGENTINA                 |   1994 | 4625359957.82118
 ARGENTINA                 |   1993 | 4616673185.85386
 ARGENTINA                 |   1992 | 4639874620.22776
 BRAZIL                    |   1998 | 2742530994.83815
 BRAZIL                    |   1997 | 4665763902.20006
 BRAZIL                    |   1996 | 4683092668.64427
 BRAZIL                    |   1995 | 4664801508.94528
 BRAZIL                    |   1994 | 4668683322.12291
 BRAZIL                    |   1993 | 4662431141.98792
 BRAZIL                    |   1992 | 4690640882.75543
 CANADA                    |   1998 | 2750640045.16359
 CANADA                    |   1997 |  4667127585.2515
 CANADA                    |   1996 | 4707501880.02247
 CANADA                    |   1995 | 4679502381.10026
 CANADA                    |   1994 | 4683903583.65856
 CANADA                    |   1993 | 4681222469.61206
 CANADA                    |   1992 | 4678731348.69846
 CHINA                     |   1998 | 2734915744.01335
 CHINA                     |   1997 |  4667449843.7882
 CHINA                     |   1996 | 4706386285.18614
 CHINA                     |   1995 |  4667573806.6711
 CHINA                     |   1994 | 4650727923.83484
 CHINA                     |   1993 |  4665199720.2784
 CHINA                     |   1992 |   4689404781.248
 EGYPT                     |   1998 |  2722705120.3775
 EGYPT                     |   1997 | 4679592765.51565
 EGYPT                     |   1996 | 4698104911.58555
 EGYPT                     |   1995 | 4685782690.61788
 EGYPT                     |   1994 | 4689531284.55805
 EGYPT                     |   1993 | 4681822610.81797
 EGYPT                     |   1992 |  4673812390.1307
 ETHIOPIA                  |   1998 | 2788523574.68662
 ETHIOPIA                  |   1997 | 4724473165.01884
 ETHIOPIA                  |   1996 | 4737511123.23071
 ETHIOPIA                  |   1995 | 4716136039.28298
 ETHIOPIA                  |   1994 | 4752908909.26438
 ETHIOPIA                  |   1993 |  4735786424.5115
 ETHIOPIA                  |   1992 | 4758886231.51618
 FRANCE                    |   1998 | 2744899461.95479
 FRANCE                    |   1997 |  4658280336.7668
 FRANCE                    |   1996 | 4677113937.60657
 FRANCE                    |   1995 |  4679762674.3292
 FRANCE                    |   1994 | 4663962820.97538
 FRANCE                    |   1993 |   4678216700.017
 FRANCE                    |   1992 | 4657957509.65928
 GERMANY                   |   1998 | 2751503021.47677
 GERMANY                   |   1997 | 4676759318.92436
 GERMANY                   |   1996 |  4685632867.9456
 GERMANY                   |   1995 | 4680648647.65477
 GERMANY                   |   1994 | 4697787475.07318
 GERMANY                   |   1993 | 4659963109.55742
 GERMANY                   |   1992 | 4665582267.49308
 INDIA                     |   1998 | 2748696973.71148
 INDIA                     |   1997 | 4663851647.97406
 INDIA                     |   1996 | 4666585387.96754
 INDIA                     |   1995 | 4656616553.99075
 INDIA                     |   1994 | 4650301154.01455
 INDIA                     |   1993 | 4656240379.59237
 INDIA                     |   1992 | 4700341453.67266
 INDONESIA                 |   1998 | 2725640076.32389
 INDONESIA                 |   1997 | 4655183729.59216
 INDONESIA                 |   1996 | 4626482606.58748
 INDONESIA                 |   1995 | 4663491656.13172
 INDONESIA                 |   1994 | 4645815577.36691
 INDONESIA                 |   1993 | 4633966232.83064
 INDONESIA                 |   1992 | 4656193900.83029
 IRAN                      |   1998 | 2726853696.33095
 IRAN                      |   1997 | 4659483194.89941
 IRAN                      |   1996 | 4671685061.78949
 IRAN                      |   1995 | 4661669176.85136
 IRAN                      |   1994 | 4677729625.68717
 IRAN                      |   1993 | 4667460183.64479
 IRAN                      |   1992 | 4665471272.55297
 IRAQ                      |   1998 | 2718885868.96936
 IRAQ                      |   1997 | 4611183345.88499
 IRAQ                      |   1996 | 4637486921.67589
 IRAQ                      |   1995 | 4646046203.47723
 IRAQ                      |   1994 | 4617357143.14783
 IRAQ                      |   1993 | 4631804120.37981
 IRAQ                      |   1992 | 4658152087.10391
 JAPAN                     |   1998 | 2731380376.53596
 JAPAN                     |   1997 | 4651085787.56781
 JAPAN                     |   1996 | 4642498646.54687
 JAPAN                     |   1995 | 4654175163.39725
 JAPAN                     |   1994 | 4658796349.44801
 JAPAN                     |   1993 | 4622894031.26007
 JAPAN                     |   1992 |    4664766839.96
 JORDAN                    |   1998 | 2741710152.17027
 JORDAN                    |   1997 | 4658734024.25666
 JORDAN                    |   1996 | 4687117797.66887
 JORDAN                    |   1995 | 4641135837.08082
 JORDAN                    |   1994 | 4663301283.27785
 JORDAN                    |   1993 | 4650889742.61056
 JORDAN                    |   1992 | 4635354559.11723
 KENYA                     |   1998 | 2730190654.63598
 KENYA                     |   1997 | 4661625698.39334
 KENYA                     |   1996 | 4663690615.22289
 KENYA                     |   1995 | 4623010717.95156
 KENYA                     |   1994 | 4661230899.91968
 KENYA                     |   1993 | 4653353931.06439
 KENYA                     |   1992 | 4673209282.47692
 MOROCCO                   |   1998 | 2719126191.87956
 MOROCCO                   |   1997 | 4677686691.73975
 MOROCCO                   |   1996 | 4675452567.70215
 MOROCCO                   |   1995 | 4664266294.96087
 MOROCCO                   |   1994 | 4641203788.08096
 MOROCCO                   |   1993 | 4664677468.25215
 MOROCCO                   |   1992 | 4666162936.14134
 MOZAMBIQUE                |   1998 | 2737940660.94439
 MOZAMBIQUE                |   1997 | 4654364252.02384
 MOZAMBIQUE                |   1996 |  4661579156.9089
 MOZAMBIQUE                |   1995 |  4641778534.6622
 MOZAMBIQUE                |   1994 | 4651025490.72382
 MOZAMBIQUE                |   1993 | 4677345219.47538
 MOZAMBIQUE                |   1992 | 4663761675.60975
 PERU                      |   1998 | 2715100387.20791
 PERU                      |   1997 | 4646004970.12805
 PERU                      |   1996 | 4646055408.71399
 PERU                      |   1995 | 4648667991.30803
 PERU                      |   1994 | 4643483464.48731
 PERU                      |   1993 | 4627947493.36624
 PERU                      |   1992 | 4652601248.09272
 ROMANIA                   |   1998 | 2752722246.82838
 ROMANIA                   |   1997 | 4673391988.87179
 ROMANIA                   |   1996 | 4696835447.02536
 ROMANIA                   |   1995 | 4699372076.98796
 ROMANIA                   |   1994 | 4680907038.58776
 ROMANIA                   |   1993 | 4662805431.54916
 ROMANIA                   |   1992 | 4673746808.18837
 RUSSIA                    |   1998 | 2726008155.63662
 RUSSIA                    |   1997 | 4664919686.83564
 RUSSIA                    |   1996 | 4669901147.19701
 RUSSIA                    |   1995 |  4672660198.0944
 RUSSIA                    |   1994 |   4663280044.082
 RUSSIA                    |   1993 | 4676949920.63703
 RUSSIA                    |   1992 |  4667604154.9335
 SAUDI ARABIA              |   1998 | 2724060308.48433
 SAUDI ARABIA              |   1997 | 4674481482.40145
 SAUDI ARABIA              |   1996 |  4659975751.1094
 SAUDI ARABIA              |   1995 | 4676529779.44767
 SAUDI ARABIA              |   1994 | 4661245700.73294
 SAUDI ARABIA              |   1993 | 4680056374.07867
 SAUDI ARABIA              |   1992 | 4655543731.09228
 UNITED KINGDOM            |   1998 | 2771597050.19755
 UNITED KINGDOM            |   1997 | 4736800986.93017
 UNITED KINGDOM            |   1996 | 4734725237.94107
 UNITED KINGDOM            |   1995 | 4708958994.18675
 UNITED KINGDOM            |   1994 | 4723730888.83982
 UNITED KINGDOM            |   1993 | 4705658375.53278
 UNITED KINGDOM            |   1992 | 4738074304.68244
 UNITED STATES             |   1998 | 2741073972.05423
 UNITED STATES             |   1997 | 4642537628.47124
 UNITED STATES             |   1996 | 4703978370.13888
 UNITED STATES             |   1995 | 4651666210.05641
 UNITED STATES             |   1994 | 4690557467.86304
 UNITED STATES             |   1993 | 4663821586.86453
 UNITED STATES             |   1992 | 4677343573.94409
 VIETNAM                   |   1998 | 2742695564.67993
 VIETNAM                   |   1997 | 4696528006.99977
 VIETNAM                   |   1996 | 4720294921.84899
 VIETNAM                   |   1995 | 4689624539.78806
 VIETNAM                   |   1994 | 4685066837.17632
 VIETNAM                   |   1993 | 4688181974.57379
 VIETNAM                   |   1992 | 4704754772.05701
(175 rows)

COMMIT;
COMMIT
