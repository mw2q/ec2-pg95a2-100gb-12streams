BEGIN;
BEGIN
select
	nation,
	o_year,
	sum(amount) as sum_profit
from
	(
		select
			n_name as nation,
			extract(year from o_orderdate) as o_year,
			l_extendedprice * (1 - l_discount) - ps_supplycost * l_quantity as amount
		from
			part,
			supplier,
			lineitem,
			partsupp,
			orders,
			nation
		where
			s_suppkey = l_suppkey
			and ps_suppkey = l_suppkey
			and ps_partkey = l_partkey
			and p_partkey = l_partkey
			and o_orderkey = l_orderkey
			and s_nationkey = n_nationkey
			and p_name like '%antique%'
	) as profit
group by
	nation,
	o_year
order by
	nation,
	o_year desc;
          nation           | o_year |    sum_profit    
---------------------------+--------+------------------
 ALGERIA                   |   1998 | 2750043899.38052
 ALGERIA                   |   1997 | 4655890304.41485
 ALGERIA                   |   1996 | 4647411267.85581
 ALGERIA                   |   1995 | 4640506671.68281
 ALGERIA                   |   1994 | 4668450816.66323
 ALGERIA                   |   1993 | 4655774747.38495
 ALGERIA                   |   1992 | 4672627376.33117
 ARGENTINA                 |   1998 | 2694765100.92274
 ARGENTINA                 |   1997 | 4631377960.16797
 ARGENTINA                 |   1996 | 4649927992.74612
 ARGENTINA                 |   1995 | 4612254427.53382
 ARGENTINA                 |   1994 | 4625935308.07741
 ARGENTINA                 |   1993 | 4631477025.45557
 ARGENTINA                 |   1992 | 4648980565.84044
 BRAZIL                    |   1998 | 2712176722.93399
 BRAZIL                    |   1997 | 4656920290.65683
 BRAZIL                    |   1996 |  4656299969.4605
 BRAZIL                    |   1995 | 4640565035.53544
 BRAZIL                    |   1994 | 4675912934.50067
 BRAZIL                    |   1993 | 4654609602.58064
 BRAZIL                    |   1992 | 4651947977.95159
 CANADA                    |   1998 | 2750663710.20182
 CANADA                    |   1997 | 4681698731.52293
 CANADA                    |   1996 | 4684711849.50541
 CANADA                    |   1995 |   4673183395.007
 CANADA                    |   1994 | 4665168540.29158
 CANADA                    |   1993 | 4698598554.66612
 CANADA                    |   1992 | 4691058393.34146
 CHINA                     |   1998 | 2735629296.82776
 CHINA                     |   1997 | 4659471001.48267
 CHINA                     |   1996 |  4676141454.7605
 CHINA                     |   1995 | 4656508206.06725
 CHINA                     |   1994 | 4672882136.80608
 CHINA                     |   1993 | 4673110144.47763
 CHINA                     |   1992 | 4663065640.81093
 EGYPT                     |   1998 |  2760362530.0834
 EGYPT                     |   1997 | 4694417495.82836
 EGYPT                     |   1996 | 4703494689.53765
 EGYPT                     |   1995 | 4688428353.57981
 EGYPT                     |   1994 | 4681737645.92472
 EGYPT                     |   1993 |  4718947302.6809
 EGYPT                     |   1992 | 4693326492.56767
 ETHIOPIA                  |   1998 | 2767885267.98453
 ETHIOPIA                  |   1997 | 4714037270.85595
 ETHIOPIA                  |   1996 | 4704091053.83441
 ETHIOPIA                  |   1995 | 4706576229.89097
 ETHIOPIA                  |   1994 | 4691662620.10616
 ETHIOPIA                  |   1993 | 4703998953.02754
 ETHIOPIA                  |   1992 |  4713725137.4572
 FRANCE                    |   1998 | 2743961149.15089
 FRANCE                    |   1997 | 4699761416.62408
 FRANCE                    |   1996 | 4668551038.45411
 FRANCE                    |   1995 | 4675697961.00643
 FRANCE                    |   1994 | 4674289821.63698
 FRANCE                    |   1993 | 4685355647.30292
 FRANCE                    |   1992 | 4671691831.45201
 GERMANY                   |   1998 | 2775759264.36579
 GERMANY                   |   1997 | 4721756459.58324
 GERMANY                   |   1996 | 4717695956.98891
 GERMANY                   |   1995 | 4691051346.97465
 GERMANY                   |   1994 |  4728105029.1138
 GERMANY                   |   1993 | 4706477019.88672
 GERMANY                   |   1992 | 4731503131.92951
 INDIA                     |   1998 | 2752034198.89232
 INDIA                     |   1997 | 4689882786.19669
 INDIA                     |   1996 |  4696240132.2331
 INDIA                     |   1995 | 4708450145.65602
 INDIA                     |   1994 | 4712022540.64176
 INDIA                     |   1993 | 4703761845.87751
 INDIA                     |   1992 | 4703943727.47741
 INDONESIA                 |   1998 | 2721109373.53135
 INDONESIA                 |   1997 | 4621962126.30639
 INDONESIA                 |   1996 | 4636500658.66999
 INDONESIA                 |   1995 | 4617230566.49129
 INDONESIA                 |   1994 | 4614035713.03745
 INDONESIA                 |   1993 | 4616393893.87142
 INDONESIA                 |   1992 | 4647161283.95304
 IRAN                      |   1998 | 2742485800.63584
 IRAN                      |   1997 | 4651032845.09251
 IRAN                      |   1996 | 4696729925.01009
 IRAN                      |   1995 | 4646589109.66638
 IRAN                      |   1994 | 4661220485.41104
 IRAN                      |   1993 |  4642503874.5128
 IRAN                      |   1992 | 4676570784.59102
 IRAQ                      |   1998 | 2731027064.30737
 IRAQ                      |   1997 | 4651664148.81534
 IRAQ                      |   1996 | 4647405429.86124
 IRAQ                      |   1995 | 4651846461.41079
 IRAQ                      |   1994 | 4646641762.48834
 IRAQ                      |   1993 | 4654510036.44706
 IRAQ                      |   1992 | 4670478932.09413
 JAPAN                     |   1998 | 2714670214.14101
 JAPAN                     |   1997 | 4620851682.71538
 JAPAN                     |   1996 | 4641833201.43986
 JAPAN                     |   1995 | 4616162077.33467
 JAPAN                     |   1994 | 4639914548.55421
 JAPAN                     |   1993 |  4626352713.0797
 JAPAN                     |   1992 | 4618901740.66957
 JORDAN                    |   1998 | 2731593969.41615
 JORDAN                    |   1997 | 4654642204.72043
 JORDAN                    |   1996 | 4711205688.05025
 JORDAN                    |   1995 | 4662139275.12399
 JORDAN                    |   1994 | 4669595455.74703
 JORDAN                    |   1993 | 4690857885.84239
 JORDAN                    |   1992 |  4674946750.3567
 KENYA                     |   1998 | 2715455047.12198
 KENYA                     |   1997 | 4637038215.70979
 KENYA                     |   1996 |  4659478315.7667
 KENYA                     |   1995 |   4636336083.793
 KENYA                     |   1994 | 4652556941.43138
 KENYA                     |   1993 |  4621249495.0694
 KENYA                     |   1992 | 4646885326.43677
 MOROCCO                   |   1998 | 2733922980.82754
 MOROCCO                   |   1997 | 4705574889.25597
 MOROCCO                   |   1996 | 4681879384.91162
 MOROCCO                   |   1995 | 4692753079.22188
 MOROCCO                   |   1994 | 4670301782.75876
 MOROCCO                   |   1993 | 4691121764.95543
 MOROCCO                   |   1992 | 4694889280.27431
 MOZAMBIQUE                |   1998 | 2725656487.20396
 MOZAMBIQUE                |   1997 | 4658468048.92676
 MOZAMBIQUE                |   1996 |  4665202332.4653
 MOZAMBIQUE                |   1995 | 4657660341.77916
 MOZAMBIQUE                |   1994 | 4649392836.02637
 MOZAMBIQUE                |   1993 | 4665833049.67182
 MOZAMBIQUE                |   1992 | 4699216915.64759
 PERU                      |   1998 | 2714108448.31662
 PERU                      |   1997 | 4659485504.98688
 PERU                      |   1996 | 4665880387.36452
 PERU                      |   1995 | 4639106246.33101
 PERU                      |   1994 |  4652090888.9621
 PERU                      |   1993 | 4663853212.06064
 PERU                      |   1992 | 4668454114.32093
 ROMANIA                   |   1998 | 2749519427.85621
 ROMANIA                   |   1997 | 4663327148.68464
 ROMANIA                   |   1996 | 4686526755.93722
 ROMANIA                   |   1995 | 4673895298.90543
 ROMANIA                   |   1994 | 4677995244.57592
 ROMANIA                   |   1993 | 4655673458.55098
 ROMANIA                   |   1992 | 4689399731.33702
 RUSSIA                    |   1998 | 2731887835.05974
 RUSSIA                    |   1997 | 4676020654.79413
 RUSSIA                    |   1996 | 4691008949.90053
 RUSSIA                    |   1995 | 4682962182.89059
 RUSSIA                    |   1994 | 4671473581.59644
 RUSSIA                    |   1993 | 4673694401.77214
 RUSSIA                    |   1992 | 4678224308.95678
 SAUDI ARABIA              |   1998 | 2724638133.81461
 SAUDI ARABIA              |   1997 | 4673872433.49032
 SAUDI ARABIA              |   1996 | 4682424089.11959
 SAUDI ARABIA              |   1995 | 4669251622.89139
 SAUDI ARABIA              |   1994 | 4667341674.52567
 SAUDI ARABIA              |   1993 | 4660155408.46284
 SAUDI ARABIA              |   1992 | 4667410503.78336
 UNITED KINGDOM            |   1998 |  2754796052.3218
 UNITED KINGDOM            |   1997 | 4703789451.60381
 UNITED KINGDOM            |   1996 | 4723912999.06839
 UNITED KINGDOM            |   1995 | 4716017111.34628
 UNITED KINGDOM            |   1994 | 4701056172.76311
 UNITED KINGDOM            |   1993 | 4679191750.75223
 UNITED KINGDOM            |   1992 | 4716176296.09545
 UNITED STATES             |   1998 | 2750704382.33356
 UNITED STATES             |   1997 | 4690562556.77002
 UNITED STATES             |   1996 |  4698401542.9885
 UNITED STATES             |   1995 | 4702069362.77225
 UNITED STATES             |   1994 |  4673000073.2703
 UNITED STATES             |   1993 | 4674355129.08893
 UNITED STATES             |   1992 | 4664052960.35842
 VIETNAM                   |   1998 | 2759000287.50163
 VIETNAM                   |   1997 | 4722879334.43533
 VIETNAM                   |   1996 | 4679292324.98169
 VIETNAM                   |   1995 | 4692992848.36506
 VIETNAM                   |   1994 | 4668605537.20234
 VIETNAM                   |   1993 | 4701436616.16898
 VIETNAM                   |   1992 | 4702951580.77017
(175 rows)

COMMIT;
COMMIT
