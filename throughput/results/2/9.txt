BEGIN;
BEGIN
select
	nation,
	o_year,
	sum(amount) as sum_profit
from
	(
		select
			n_name as nation,
			extract(year from o_orderdate) as o_year,
			l_extendedprice * (1 - l_discount) - ps_supplycost * l_quantity as amount
		from
			part,
			supplier,
			lineitem,
			partsupp,
			orders,
			nation
		where
			s_suppkey = l_suppkey
			and ps_suppkey = l_suppkey
			and ps_partkey = l_partkey
			and p_partkey = l_partkey
			and o_orderkey = l_orderkey
			and s_nationkey = n_nationkey
			and p_name like '%peach%'
	) as profit
group by
	nation,
	o_year
order by
	nation,
	o_year desc;
          nation           | o_year |    sum_profit    
---------------------------+--------+------------------
 ALGERIA                   |   1998 | 2762815947.15319
 ALGERIA                   |   1997 | 4669805096.53128
 ALGERIA                   |   1996 | 4715602926.40552
 ALGERIA                   |   1995 |  4674242467.8134
 ALGERIA                   |   1994 | 4692135948.72025
 ALGERIA                   |   1993 | 4657001341.82758
 ALGERIA                   |   1992 | 4679004718.61656
 ARGENTINA                 |   1998 | 2707098819.98647
 ARGENTINA                 |   1997 | 4635256872.62415
 ARGENTINA                 |   1996 | 4616882509.56455
 ARGENTINA                 |   1995 | 4605894378.07793
 ARGENTINA                 |   1994 | 4600733292.67691
 ARGENTINA                 |   1993 |  4627736094.2683
 ARGENTINA                 |   1992 | 4663698941.20901
 BRAZIL                    |   1998 |  2735141594.1889
 BRAZIL                    |   1997 | 4644315128.54809
 BRAZIL                    |   1996 | 4662289825.45775
 BRAZIL                    |   1995 | 4645911837.04971
 BRAZIL                    |   1994 | 4623926566.83809
 BRAZIL                    |   1993 |  4650200867.9299
 BRAZIL                    |   1992 | 4687749620.99988
 CANADA                    |   1998 | 2755489844.68241
 CANADA                    |   1997 | 4674048943.98274
 CANADA                    |   1996 | 4680615840.53692
 CANADA                    |   1995 | 4672711023.69834
 CANADA                    |   1994 | 4690592918.58252
 CANADA                    |   1993 |  4693363531.8673
 CANADA                    |   1992 |  4685119707.8957
 CHINA                     |   1998 | 2736853669.03255
 CHINA                     |   1997 | 4702009735.26992
 CHINA                     |   1996 | 4705007783.85686
 CHINA                     |   1995 |  4675442787.1038
 CHINA                     |   1994 | 4683248684.30082
 CHINA                     |   1993 | 4663111895.59949
 CHINA                     |   1992 | 4684066691.20692
 EGYPT                     |   1998 | 2733418846.33929
 EGYPT                     |   1997 | 4671773047.26877
 EGYPT                     |   1996 | 4700690983.46923
 EGYPT                     |   1995 | 4675847962.14631
 EGYPT                     |   1994 | 4665076112.70826
 EGYPT                     |   1993 | 4684317407.98549
 EGYPT                     |   1992 | 4690612982.71402
 ETHIOPIA                  |   1998 | 2751443362.48334
 ETHIOPIA                  |   1997 | 4708441698.02592
 ETHIOPIA                  |   1996 | 4713849322.34249
 ETHIOPIA                  |   1995 | 4732518935.30487
 ETHIOPIA                  |   1994 | 4719449288.58501
 ETHIOPIA                  |   1993 | 4682791232.23799
 ETHIOPIA                  |   1992 | 4717359893.95577
 FRANCE                    |   1998 | 2717390035.59315
 FRANCE                    |   1997 | 4633221185.76554
 FRANCE                    |   1996 | 4685282557.40033
 FRANCE                    |   1995 | 4638044741.67815
 FRANCE                    |   1994 | 4651915337.64663
 FRANCE                    |   1993 | 4647874431.25096
 FRANCE                    |   1992 |  4644655418.2594
 GERMANY                   |   1998 | 2722786781.03826
 GERMANY                   |   1997 | 4687361817.47061
 GERMANY                   |   1996 |  4702499379.7182
 GERMANY                   |   1995 | 4670844569.12795
 GERMANY                   |   1994 | 4652085867.18463
 GERMANY                   |   1993 | 4690029627.66408
 GERMANY                   |   1992 | 4699500569.15523
 INDIA                     |   1998 | 2759872707.56681
 INDIA                     |   1997 | 4707412805.23671
 INDIA                     |   1996 | 4695817403.88597
 INDIA                     |   1995 | 4685694735.01296
 INDIA                     |   1994 | 4693052809.57139
 INDIA                     |   1993 | 4683445775.33896
 INDIA                     |   1992 | 4721558561.49594
 INDONESIA                 |   1998 | 2738206563.95866
 INDONESIA                 |   1997 |  4648140172.6853
 INDONESIA                 |   1996 | 4644182822.45912
 INDONESIA                 |   1995 | 4646539717.34336
 INDONESIA                 |   1994 | 4668373332.61797
 INDONESIA                 |   1993 | 4614566970.21292
 INDONESIA                 |   1992 | 4634631806.04262
 IRAN                      |   1998 | 2724142115.78856
 IRAN                      |   1997 | 4663481868.81703
 IRAN                      |   1996 | 4654379811.18001
 IRAN                      |   1995 |  4658569349.0483
 IRAN                      |   1994 | 4644076293.11619
 IRAN                      |   1993 |   4654475173.162
 IRAN                      |   1992 | 4653521296.17648
 IRAQ                      |   1998 | 2722027068.76085
 IRAQ                      |   1997 | 4650522441.75893
 IRAQ                      |   1996 | 4676077610.62561
 IRAQ                      |   1995 | 4648816400.75846
 IRAQ                      |   1994 |   4664113670.809
 IRAQ                      |   1993 | 4671011015.77526
 IRAQ                      |   1992 | 4654900198.04968
 JAPAN                     |   1998 | 2708652566.18408
 JAPAN                     |   1997 | 4602076868.33425
 JAPAN                     |   1996 | 4613027181.24515
 JAPAN                     |   1995 | 4625849465.19065
 JAPAN                     |   1994 | 4636705781.82132
 JAPAN                     |   1993 | 4619481956.87295
 JAPAN                     |   1992 | 4643982546.71422
 JORDAN                    |   1998 | 2745703682.40698
 JORDAN                    |   1997 | 4684517318.29076
 JORDAN                    |   1996 | 4677761035.28259
 JORDAN                    |   1995 | 4678954673.02772
 JORDAN                    |   1994 |  4637582189.9541
 JORDAN                    |   1993 | 4663203001.47969
 JORDAN                    |   1992 | 4657298390.60911
 KENYA                     |   1998 | 2730809904.95778
 KENYA                     |   1997 | 4622484595.54144
 KENYA                     |   1996 | 4643948279.92715
 KENYA                     |   1995 | 4625250663.17318
 KENYA                     |   1994 | 4627194044.58149
 KENYA                     |   1993 | 4609163405.49058
 KENYA                     |   1992 | 4632090934.08342
 MOROCCO                   |   1998 |  2760565914.8534
 MOROCCO                   |   1997 | 4705771262.68497
 MOROCCO                   |   1996 | 4692120497.40498
 MOROCCO                   |   1995 | 4696230519.05984
 MOROCCO                   |   1994 | 4723795573.36033
 MOROCCO                   |   1993 |  4682637729.2447
 MOROCCO                   |   1992 | 4704860582.80641
 MOZAMBIQUE                |   1998 | 2732303667.56467
 MOZAMBIQUE                |   1997 | 4675440864.98134
 MOZAMBIQUE                |   1996 | 4717627446.20881
 MOZAMBIQUE                |   1995 | 4695469546.23099
 MOZAMBIQUE                |   1994 | 4696861010.39974
 MOZAMBIQUE                |   1993 | 4692746508.90872
 MOZAMBIQUE                |   1992 | 4730755698.29214
 PERU                      |   1998 |  2724840561.9801
 PERU                      |   1997 | 4623024879.80405
 PERU                      |   1996 | 4659795390.08374
 PERU                      |   1995 |  4630986964.2869
 PERU                      |   1994 | 4644479544.99291
 PERU                      |   1993 | 4623661743.77754
 PERU                      |   1992 |  4671738909.3504
 ROMANIA                   |   1998 | 2741957300.69739
 ROMANIA                   |   1997 | 4662125386.88278
 ROMANIA                   |   1996 | 4645010065.72022
 ROMANIA                   |   1995 | 4674207893.03964
 ROMANIA                   |   1994 | 4677246653.02295
 ROMANIA                   |   1993 | 4660697565.22879
 ROMANIA                   |   1992 | 4667985121.02191
 RUSSIA                    |   1998 | 2714064792.73995
 RUSSIA                    |   1997 | 4648800631.92706
 RUSSIA                    |   1996 | 4680192543.70254
 RUSSIA                    |   1995 | 4681042267.75376
 RUSSIA                    |   1994 | 4665066641.30114
 RUSSIA                    |   1993 |  4677776291.0646
 RUSSIA                    |   1992 | 4695289010.93738
 SAUDI ARABIA              |   1998 | 2728676118.61595
 SAUDI ARABIA              |   1997 | 4624684239.67477
 SAUDI ARABIA              |   1996 | 4659309175.72487
 SAUDI ARABIA              |   1995 | 4647326247.18151
 SAUDI ARABIA              |   1994 |  4663661840.4642
 SAUDI ARABIA              |   1993 | 4654341447.89372
 SAUDI ARABIA              |   1992 | 4663441214.07045
 UNITED KINGDOM            |   1998 | 2753679924.77325
 UNITED KINGDOM            |   1997 | 4675137791.52579
 UNITED KINGDOM            |   1996 | 4677751343.26619
 UNITED KINGDOM            |   1995 | 4687333645.04727
 UNITED KINGDOM            |   1994 | 4676767078.68544
 UNITED KINGDOM            |   1993 | 4668869167.98939
 UNITED KINGDOM            |   1992 | 4689512489.22276
 UNITED STATES             |   1998 | 2766173642.34706
 UNITED STATES             |   1997 | 4686698089.20363
 UNITED STATES             |   1996 | 4713868075.20238
 UNITED STATES             |   1995 | 4674270891.82017
 UNITED STATES             |   1994 | 4707111494.22956
 UNITED STATES             |   1993 | 4686965103.63568
 UNITED STATES             |   1992 | 4688941692.41485
 VIETNAM                   |   1998 |  2756257117.2828
 VIETNAM                   |   1997 |  4680209604.4149
 VIETNAM                   |   1996 | 4694383024.34884
 VIETNAM                   |   1995 | 4692374326.02579
 VIETNAM                   |   1994 | 4705970827.31468
 VIETNAM                   |   1993 | 4694711571.15267
 VIETNAM                   |   1992 | 4704238155.50491
(175 rows)

COMMIT;
COMMIT
