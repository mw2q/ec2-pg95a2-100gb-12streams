BEGIN;
BEGIN
select
	nation,
	o_year,
	sum(amount) as sum_profit
from
	(
		select
			n_name as nation,
			extract(year from o_orderdate) as o_year,
			l_extendedprice * (1 - l_discount) - ps_supplycost * l_quantity as amount
		from
			part,
			supplier,
			lineitem,
			partsupp,
			orders,
			nation
		where
			s_suppkey = l_suppkey
			and ps_suppkey = l_suppkey
			and ps_partkey = l_partkey
			and p_partkey = l_partkey
			and o_orderkey = l_orderkey
			and s_nationkey = n_nationkey
			and p_name like '%cyan%'
	) as profit
group by
	nation,
	o_year
order by
	nation,
	o_year desc;
          nation           | o_year |    sum_profit    
---------------------------+--------+------------------
 ALGERIA                   |   1998 | 2762253239.26939
 ALGERIA                   |   1997 | 4689858869.30479
 ALGERIA                   |   1996 |  4705567371.0613
 ALGERIA                   |   1995 | 4698024984.13403
 ALGERIA                   |   1994 | 4712563884.15389
 ALGERIA                   |   1993 | 4673540089.08852
 ALGERIA                   |   1992 | 4711106031.53508
 ARGENTINA                 |   1998 | 2716751256.60425
 ARGENTINA                 |   1997 | 4651799514.14488
 ARGENTINA                 |   1996 |  4649589307.8046
 ARGENTINA                 |   1995 | 4628097923.18947
 ARGENTINA                 |   1994 | 4635878657.59311
 ARGENTINA                 |   1993 | 4632145660.21827
 ARGENTINA                 |   1992 | 4672260340.22157
 BRAZIL                    |   1998 | 2733655153.58392
 BRAZIL                    |   1997 | 4681275337.68166
 BRAZIL                    |   1996 | 4682768238.20423
 BRAZIL                    |   1995 | 4695100743.74096
 BRAZIL                    |   1994 | 4651261223.65566
 BRAZIL                    |   1993 | 4678597901.06282
 BRAZIL                    |   1992 |  4713096294.0934
 CANADA                    |   1998 | 2717691548.88994
 CANADA                    |   1997 |   4724969598.463
 CANADA                    |   1996 | 4686923611.19592
 CANADA                    |   1995 | 4676158822.45937
 CANADA                    |   1994 |  4668766343.1511
 CANADA                    |   1993 | 4670551701.41039
 CANADA                    |   1992 | 4675040055.03038
 CHINA                     |   1998 | 2754499935.24475
 CHINA                     |   1997 | 4670223393.88108
 CHINA                     |   1996 | 4720062043.28231
 CHINA                     |   1995 | 4672760698.30753
 CHINA                     |   1994 |  4673730001.3477
 CHINA                     |   1993 | 4685075121.67462
 CHINA                     |   1992 | 4689015153.13122
 EGYPT                     |   1998 |  2729442412.4502
 EGYPT                     |   1997 | 4681917091.93342
 EGYPT                     |   1996 | 4703421201.42078
 EGYPT                     |   1995 | 4673027007.15723
 EGYPT                     |   1994 | 4683153284.75424
 EGYPT                     |   1993 |  4691190523.8122
 EGYPT                     |   1992 | 4682771703.65424
 ETHIOPIA                  |   1998 | 2748651327.30217
 ETHIOPIA                  |   1997 | 4718922388.53275
 ETHIOPIA                  |   1996 | 4692969791.22818
 ETHIOPIA                  |   1995 | 4703510703.98494
 ETHIOPIA                  |   1994 | 4714410465.85805
 ETHIOPIA                  |   1993 | 4692743053.95813
 ETHIOPIA                  |   1992 | 4734394839.79432
 FRANCE                    |   1998 | 2743282320.78885
 FRANCE                    |   1997 | 4695699311.96916
 FRANCE                    |   1996 | 4708888880.80698
 FRANCE                    |   1995 | 4690659814.59951
 FRANCE                    |   1994 | 4678923556.96453
 FRANCE                    |   1993 | 4683873049.86485
 FRANCE                    |   1992 | 4697998307.42914
 GERMANY                   |   1998 |  2765564593.1672
 GERMANY                   |   1997 | 4702571389.07131
 GERMANY                   |   1996 | 4709673155.61889
 GERMANY                   |   1995 |  4681657318.7483
 GERMANY                   |   1994 | 4690718259.56058
 GERMANY                   |   1993 | 4690901809.70769
 GERMANY                   |   1992 | 4699633639.63404
 INDIA                     |   1998 |  2765457515.1514
 INDIA                     |   1997 | 4709864671.32655
 INDIA                     |   1996 | 4724688032.29644
 INDIA                     |   1995 | 4723370742.87292
 INDIA                     |   1994 | 4711601042.45736
 INDIA                     |   1993 | 4696519856.13951
 INDIA                     |   1992 | 4730796017.97813
 INDONESIA                 |   1998 | 2746113510.15751
 INDONESIA                 |   1997 | 4629049744.28096
 INDONESIA                 |   1996 | 4626986625.29923
 INDONESIA                 |   1995 | 4616867861.67747
 INDONESIA                 |   1994 | 4611271711.72296
 INDONESIA                 |   1993 | 4617129846.48765
 INDONESIA                 |   1992 | 4608328142.50365
 IRAN                      |   1998 | 2730149638.56132
 IRAN                      |   1997 | 4648803292.91045
 IRAN                      |   1996 | 4648849305.20998
 IRAN                      |   1995 | 4632887832.65341
 IRAN                      |   1994 | 4647719324.51913
 IRAN                      |   1993 | 4650271807.88738
 IRAN                      |   1992 | 4642127224.78735
 IRAQ                      |   1998 | 2730015578.81042
 IRAQ                      |   1997 | 4654600119.95526
 IRAQ                      |   1996 | 4675324131.78192
 IRAQ                      |   1995 | 4668268151.01259
 IRAQ                      |   1994 | 4644418056.77434
 IRAQ                      |   1993 |   4648062535.508
 IRAQ                      |   1992 | 4669673448.34401
 JAPAN                     |   1998 | 2695440333.11621
 JAPAN                     |   1997 | 4639309413.44419
 JAPAN                     |   1996 | 4659336690.45883
 JAPAN                     |   1995 | 4638501917.21016
 JAPAN                     |   1994 | 4627791354.90803
 JAPAN                     |   1993 | 4604442067.75097
 JAPAN                     |   1992 | 4647673750.54784
 JORDAN                    |   1998 | 2736849285.57321
 JORDAN                    |   1997 | 4657973036.72414
 JORDAN                    |   1996 | 4693555782.39651
 JORDAN                    |   1995 | 4671483048.51404
 JORDAN                    |   1994 | 4659354441.59805
 JORDAN                    |   1993 | 4678947581.99904
 JORDAN                    |   1992 | 4678621424.87112
 KENYA                     |   1998 | 2722072571.97472
 KENYA                     |   1997 | 4613803843.08795
 KENYA                     |   1996 | 4641199179.29537
 KENYA                     |   1995 | 4642297412.68445
 KENYA                     |   1994 | 4637170886.55866
 KENYA                     |   1993 | 4637263152.79192
 KENYA                     |   1992 | 4649329495.80739
 MOROCCO                   |   1998 | 2731288687.65867
 MOROCCO                   |   1997 |   4656463021.645
 MOROCCO                   |   1996 | 4688630445.48307
 MOROCCO                   |   1995 | 4676554346.75994
 MOROCCO                   |   1994 | 4690164858.26239
 MOROCCO                   |   1993 | 4665578484.44015
 MOROCCO                   |   1992 | 4717738464.15353
 MOZAMBIQUE                |   1998 | 2723666596.54924
 MOZAMBIQUE                |   1997 | 4665778636.94293
 MOZAMBIQUE                |   1996 | 4688714645.56008
 MOZAMBIQUE                |   1995 | 4657867681.43264
 MOZAMBIQUE                |   1994 | 4646597204.19101
 MOZAMBIQUE                |   1993 | 4655311181.40042
 MOZAMBIQUE                |   1992 | 4657026971.94126
 PERU                      |   1998 | 2718059581.83498
 PERU                      |   1997 | 4622510283.83762
 PERU                      |   1996 | 4621527505.43434
 PERU                      |   1995 | 4616389169.51624
 PERU                      |   1994 | 4622953669.30704
 PERU                      |   1993 |  4630655430.0068
 PERU                      |   1992 |  4609488146.6938
 ROMANIA                   |   1998 |  2726937178.6972
 ROMANIA                   |   1997 | 4668704206.62386
 ROMANIA                   |   1996 | 4689461580.14919
 ROMANIA                   |   1995 | 4677503073.87528
 ROMANIA                   |   1994 | 4686078699.74578
 ROMANIA                   |   1993 | 4685761121.22431
 ROMANIA                   |   1992 | 4679471193.35883
 RUSSIA                    |   1998 | 2729411649.81605
 RUSSIA                    |   1997 | 4659727685.25799
 RUSSIA                    |   1996 | 4686623413.75768
 RUSSIA                    |   1995 | 4631158287.60752
 RUSSIA                    |   1994 | 4648464316.06315
 RUSSIA                    |   1993 | 4646325117.38996
 RUSSIA                    |   1992 | 4662427278.04958
 SAUDI ARABIA              |   1998 | 2742300547.03618
 SAUDI ARABIA              |   1997 | 4705395930.41882
 SAUDI ARABIA              |   1996 | 4719204680.94189
 SAUDI ARABIA              |   1995 | 4684235568.55746
 SAUDI ARABIA              |   1994 | 4698923007.96664
 SAUDI ARABIA              |   1993 | 4685686133.12601
 SAUDI ARABIA              |   1992 | 4688499919.60248
 UNITED KINGDOM            |   1998 | 2758758429.27112
 UNITED KINGDOM            |   1997 | 4694173020.22218
 UNITED KINGDOM            |   1996 | 4701472920.03126
 UNITED KINGDOM            |   1995 | 4673893871.92815
 UNITED KINGDOM            |   1994 | 4709750321.70694
 UNITED KINGDOM            |   1993 | 4670383394.08421
 UNITED KINGDOM            |   1992 | 4710973342.03322
 UNITED STATES             |   1998 |  2735124354.0497
 UNITED STATES             |   1997 | 4684217129.61173
 UNITED STATES             |   1996 | 4676877937.26576
 UNITED STATES             |   1995 | 4650427084.25844
 UNITED STATES             |   1994 | 4687189913.87489
 UNITED STATES             |   1993 | 4682669986.94744
 UNITED STATES             |   1992 | 4674841477.52371
 VIETNAM                   |   1998 | 2756770492.50437
 VIETNAM                   |   1997 | 4667868963.14021
 VIETNAM                   |   1996 | 4702451071.01387
 VIETNAM                   |   1995 | 4695675492.47365
 VIETNAM                   |   1994 | 4688744570.40828
 VIETNAM                   |   1993 | 4698033125.67358
 VIETNAM                   |   1992 | 4701877678.55434
(175 rows)

COMMIT;
COMMIT
